apiVersion: autoscaling/v2beta2
kinda: HorizontalPodAutoscaler
metadata:
  name: {{ include "circleci-runner.fullname" . }}
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: {{ include "circleci-runner.fullname" . }}
  minReplicas: {{ .Values.desiredReplicas }}
  maxReplicas: {{ .Values.maxReplicas }}
  metrics:
  - type: External
    external:
      metric:
        name: circleci_runners_total
        selector: "queue=circleci_{{ .Values.resourceClass }}_runners_total"
      target:
        type: AverageValue
        averageValue: 1

